(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["offers"],{"07ac":function(e,t,n){var o=n("23e7"),r=n("6f53").values;o({target:"Object",stat:!0},{values:function(e){return r(e)}})},"0d6b":function(e,t,n){"use strict";n.r(t);var o=n("7a23");function r(e,t,n,r,c,a){var i=Object(o["F"])("router-view");return Object(o["x"])(),Object(o["f"])(i)}var c={name:"Offer"},a=n("d959"),i=n.n(a);const s=i()(c,[["render",r]]);t["default"]=s},"0e34":function(e,t,n){e.exports=n.p+"img/excel.847a47e8.svg"},1148:function(e,t,n){"use strict";var o=n("da84"),r=n("5926"),c=n("577e"),a=n("1d80"),i=o.RangeError;e.exports=function(e){var t=c(a(this)),n="",o=r(e);if(o<0||o==1/0)throw i("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},"1aea":function(e,t,n){e.exports=n.p+"img/pdf.ad036780.svg"},"1cd9":function(e,t,n){},"1d60":function(e,t,n){e.exports=n.p+"img/filters.393d9f5b.svg"},"1e0b":function(e,t,n){"use strict";n("ebae")},"209a":function(e,t,n){e.exports=n.p+"img/ru.9a99cccd.svg"},"24ac":function(e,t,n){"use strict";n("a567")},"3c8e":function(e,t,n){},4622:function(e,t,n){"use strict";n("3c8e")},6120:function(e,t,n){"use strict";n("6a7e")},"64fd":function(e,t,n){},"6a7e":function(e,t,n){},"6f53":function(e,t,n){var o=n("83ab"),r=n("e330"),c=n("df75"),a=n("fc6a"),i=n("d1e7").f,s=r(i),l=r([].push),u=function(e){return function(t){var n,r=a(t),i=c(r),u=i.length,d=0,f=[];while(u>d)n=i[d++],o&&!s(r,n)||l(f,e?[n,r[n]]:r[n]);return f}};e.exports={entries:u(!0),values:u(!1)}},7197:function(e,t,n){"use strict";n.r(t);var o=n("7a23"),r=function(e){return Object(o["A"])("data-v-827cebf4"),e=e(),Object(o["y"])(),e},c={class:"offer-create"},a={class:"offer-create__title page__title"},i=Object(o["j"])(" Коммерческое предложение "),s={key:0},l={key:1,class:"offer-create__title-date"},u={class:"offer-create-wrapper page-wrapper"},d={class:"offer-create-fields fields"},f={class:"offer-create-fields-row fields-row"},b={class:"offer-create-fields-row fields-row"},p={class:"offer-create-fields-row fields-row _area"},h={class:"offer-create-fields-row fields-row"},O={class:"offer-create-fields-row fields-row"},j={class:"offer-create-fields-row fields-row"},m={class:"offer-create-fields-row fields-row _validy"},y={class:"offer-create-fields-row fields-row _area"},g={class:"offer-create-fields-row fields-row"},v={class:"offer-create-products"},_=r((function(){return Object(o["i"])("h2",{class:"offer-create-products__title"},"Продукция",-1)})),k={class:"offer-create-products-row article-row"},C={class:"offer-create-products-field article-row-field"},w={class:"offer-create-products-add article-row-button"},x=Object(o["j"])(" Добавить "),$=r((function(){return Object(o["i"])("h3",{class:"offer-create-company__title"},"Выбрать компанию",-1)})),V={class:"offer-create-company__select"},P={class:"offer-create-type"},T=r((function(){return Object(o["i"])("h4",{class:"offer-create-type__title"},"Сохранить",-1)})),S={class:"offer-create-types"},U={class:"base-check"},I=r((function(){return Object(o["i"])("label",{for:"offerCreatePdf",class:"upp"}," pdf ",-1)})),J={class:"base-check _excel"},E=r((function(){return Object(o["i"])("label",{for:"offerCreateExcel"}," Excel ",-1)})),M={class:"offer-create-type _get-ready"},q=r((function(){return Object(o["i"])("h4",{class:"offer-create-type__title _get-ready"},"Подготовить",-1)})),B={class:"offer-create-types _get-ready"},A={class:"base-check"},D=r((function(){return Object(o["i"])("label",{for:"offerReadyTz",class:"upp"}," тз ",-1)})),F={class:"base-check upp _ru"},Q=r((function(){return Object(o["i"])("label",{for:"offerReadyRu",class:"upp"}," ру ",-1)})),z={key:0,class:"offer-create-tzType"},R=r((function(){return Object(o["i"])("h5",null,"Тип",-1)})),L={class:"base-check radio"},N=r((function(){return Object(o["i"])("label",{for:"offerCreateKtru",class:"upp"}," ктру ",-1)})),K={class:"base-check radio"},G=r((function(){return Object(o["i"])("label",{for:"offerCreateTu",class:"upp"}," ту ",-1)})),H={class:"base-check radio"},W=r((function(){return Object(o["i"])("label",{for:"offerCreateKtrus"},[Object(o["i"])("span",{class:"upp"},"ктру"),Object(o["j"])(" сокр. ")],-1)})),Y={class:"offer-create-actions page-buttons"},X={class:"offer-create__send"},Z=Object(o["j"])(" Отправить "),ee={class:"offer-create__save"},te=Object(o["j"])(" Сохранить "),ne={class:"offer-create__dl"},oe=Object(o["j"])(" Скачать ");function re(e,t,n,r,re,ce){var ae=Object(o["F"])("base-input"),ie=Object(o["F"])("base-textarea"),se=Object(o["F"])("base-button"),le=Object(o["F"])("offer-create-table"),ue=Object(o["F"])("base-select"),de=Object(o["F"])("base-modal");return Object(o["x"])(),Object(o["h"])(o["b"],null,[Object(o["i"])("section",c,[Object(o["i"])("h1",a,[i,ce.edit&&re.offer?(Object(o["x"])(),Object(o["h"])("span",s,"№"+Object(o["J"])(re.offer.id),1)):Object(o["g"])("",!0),ce.edit&&re.offer?(Object(o["x"])(),Object(o["h"])("span",l,Object(o["J"])(ce.offerDate),1)):Object(o["g"])("",!0)]),Object(o["i"])("div",u,[Object(o["i"])("div",d,[Object(o["i"])("div",f,[Object(o["k"])(ae,{label:"Контрагент",id:"offerCreatecounterparty",suggestions:re.counterparties,search:!0,onSetSuggestion:t[0]||(t[0]=function(e){return ce.getCounterparty("",e)}),onKeypressEnter:t[1]||(t[1]=function(e){return ce.getCounterparty("")}),onInput:t[2]||(t[2]=function(e){return ce.getCounterparty("search")}),onClear:t[3]||(t[3]=function(e){return re.data.counterparty="",re.counterparties=[]}),modelValue:re.data.counterparty,"onUpdate:modelValue":t[4]||(t[4]=function(e){return re.data.counterparty=e})},null,8,["suggestions","modelValue"])]),Object(o["i"])("div",b,[Object(o["k"])(ae,{label:"ИНН",id:"offerCreateInn",disbled:!0,disabled:re.data.inn&&!0,readonly:re.data.inn&&!0,modelValue:re.data.inn,"onUpdate:modelValue":t[5]||(t[5]=function(e){return re.data.inn=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",p,[Object(o["k"])(ie,{label:"Адрес",id:"offerCreateAddress",disabled:re.data.address&&!0,readonly:re.data.address&&!0,modelValue:re.data.address,"onUpdate:modelValue":t[6]||(t[6]=function(e){return re.data.address=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",h,[Object(o["k"])(ae,{label:"Телефон",type:"text",id:"offerCreatePhone",disabled:re.data.phone&&!0,readonly:re.data.phone&&!0,modelValue:re.data.phone,"onUpdate:modelValue":t[7]||(t[7]=function(e){return re.data.phone=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",O,[Object(o["k"])(ae,{label:"Электронная почта",id:"offerCreateEmail",disabled:re.data.email&&!0,readonly:re.data.email&&!0,modelValue:re.data.email,"onUpdate:modelValue":t[8]||(t[8]=function(e){return re.data.email=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",j,[Object(o["k"])(ae,{label:"Контактное лицо",id:"offerCreateContact",disabled:re.data.contactPerson&&!0,readonly:re.data.contactPerson&&!0,modelValue:re.data.contactPerson,"onUpdate:modelValue":t[9]||(t[9]=function(e){return re.data.contactPerson=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",m,[Object(o["k"])(ae,{label:"Срок действия",short:!0,id:"offerCreateValidy",disabled:re.data.validy&&!0,readonly:re.data.validy&&!0,modelValue:re.data.validy,"onUpdate:modelValue":t[10]||(t[10]=function(e){return re.data.validy=e})},null,8,["disabled","readonly","modelValue"])]),Object(o["i"])("div",y,[Object(o["k"])(ae,{label:"Конечный заказчик",id:"offerCreateEndCustomer",suggestions:re.customers,search:!0,onSetSuggestion:t[11]||(t[11]=function(e){return ce.getEndCustomer("",e)}),onKeypressEnter:t[12]||(t[12]=function(e){return ce.getEndCustomer("")}),onInput:t[13]||(t[13]=function(e){return ce.getEndCustomer("search")}),onClear:t[14]||(t[14]=function(e){return re.data.endCustomer="",re.customers=[]}),modelValue:re.data.endCustomer,"onUpdate:modelValue":t[15]||(t[15]=function(e){return re.data.endCustomer=e})},null,8,["suggestions","modelValue"])]),Object(o["i"])("div",g,[Object(o["k"])(ae,{label:"Регион",id:"offerCreateRegion",disabled:re.data.region&&!0,readonly:re.data.region&&!0,modelValue:re.data.region,"onUpdate:modelValue":t[16]||(t[16]=function(e){return re.data.region=e})},null,8,["disabled","readonly","modelValue"])])]),Object(o["i"])("div",v,[_,Object(o["i"])("div",k,[Object(o["i"])("div",C,[Object(o["k"])(ae,{id:"offerCreatecounterpartyProduct",placeholder:"Артикул или наименование",search:!0,suggestions:re.productSuggestions,onSetSuggestion:t[17]||(t[17]=function(e){return ce.getProducts("",e)}),onKeypressEnter:t[18]||(t[18]=function(e){return ce.getProducts("")}),onInput:t[19]||(t[19]=function(e){return ce.getProducts("search")}),onClear:t[20]||(t[20]=function(e){return re.productsSearch="",re.productSuggestions=[],re.productToSend={}}),modelValue:re.productsSearch,"onUpdate:modelValue":t[21]||(t[21]=function(e){return re.productsSearch=e})},null,8,["suggestions","modelValue"])]),Object(o["i"])("div",w,[Object(o["k"])(se,{type:"outlined",onClicked:t[22]||(t[22]=function(e){return re.productToSend&&ce.addProduct()})},{default:Object(o["P"])((function(){return[x]})),_:1})])]),Object(o["k"])(le,{products:re.products,onEditProduct:ce.editProduct,onRemoveProduct:ce.removeProduct},null,8,["products","onEditProduct","onRemoveProduct"])]),Object(o["i"])("div",{class:Object(o["s"])(["offer-create-company",{filled:re.products.length}])},[$,Object(o["i"])("div",V,[Object(o["k"])(ue,{options:re.companies,modelValue:re.data.company,"onUpdate:modelValue":t[23]||(t[23]=function(e){return re.data.company=e}),borderOnly:!0},null,8,["options","modelValue"])])],2),Object(o["i"])("div",P,[T,Object(o["i"])("div",S,[Object(o["i"])("div",U,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"offerCreatePdf",value:"pdf","onUpdate:modelValue":t[24]||(t[24]=function(e){return re.data.tech_docs_format=e})},null,512),[[o["M"],re.data.tech_docs_format]]),I]),Object(o["i"])("div",J,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"offerCreateExcel",value:"excel","onUpdate:modelValue":t[25]||(t[25]=function(e){return re.data.tech_docs_format=e})},null,512),[[o["M"],re.data.tech_docs_format]]),E])])]),Object(o["i"])("div",M,[q,Object(o["i"])("div",B,[Object(o["i"])("div",A,[Object(o["Q"])(Object(o["i"])("input",{type:"checkbox",id:"offerReadyTz","onUpdate:modelValue":t[26]||(t[26]=function(e){return re.data.tz=e})},null,512),[[o["L"],re.data.tz]]),D]),Object(o["i"])("div",F,[Object(o["Q"])(Object(o["i"])("input",{type:"checkbox",id:"offerReadyRu","onUpdate:modelValue":t[27]||(t[27]=function(e){return re.data.ru=e})},null,512),[[o["L"],re.data.ru]]),Q])]),re.data.tz?(Object(o["x"])(),Object(o["h"])("div",z,[R,Object(o["i"])("div",null,[Object(o["i"])("div",L,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"offerCreateKtru",value:"ktru","onUpdate:modelValue":t[28]||(t[28]=function(e){return re.data.tzType=e})},null,512),[[o["M"],re.data.tzType]]),N]),Object(o["i"])("div",K,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"offerCreateTu",value:"tu","onUpdate:modelValue":t[29]||(t[29]=function(e){return re.data.tzType=e})},null,512),[[o["M"],re.data.tzType]]),G]),Object(o["i"])("div",H,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"offerCreateKtrus",value:"ktrus","onUpdate:modelValue":t[30]||(t[30]=function(e){return re.data.tzType=e})},null,512),[[o["M"],re.data.tzType]]),W])])])):Object(o["g"])("",!0)])]),Object(o["i"])("div",Y,[Object(o["i"])("div",X,[Object(o["k"])(se,{type:"filled",onClicked:t[31]||(t[31]=function(e){return ce.sendToEmail(ce.edit?"saved":"")})},{default:Object(o["P"])((function(){return[Z]})),_:1})]),Object(o["i"])("div",ee,[Object(o["k"])(se,{type:"outlined",onClicked:ce.saveOffer},{default:Object(o["P"])((function(){return[te]})),_:1},8,["onClicked"])]),Object(o["i"])("div",ne,[Object(o["k"])(se,{onClicked:t[32]||(t[32]=function(e){return ce.download(ce.edit?"saved":"")}),type:"outlined"},{default:Object(o["P"])((function(){return[oe]})),_:1})])])]),Object(o["k"])(de,{open:re.openModal,text:re.modalText,onClose:ce.closeModal},null,8,["open","text","onClose"])],64)}var ce=n("ade3"),ae=n("b85c"),ie=(n("0d03"),n("99af"),n("b0c0"),n("45fc"),n("d3b7"),n("d9e2"),n("d401"),n("c740"),n("a434"),n("213a")),se=["for"],le=["id","name","required","disabled","readonly","placeholder","value","minLength","maxlength"],ue={key:1,class:"based-textarea__msg"};function de(e,t,n,r,c,a){return Object(o["x"])(),Object(o["h"])("div",{class:Object(o["s"])(["based-textarea",{"based-textarea-error":n.message,"based-textarea-row":n.label}])},[n.label?(Object(o["x"])(),Object(o["h"])("label",{key:0,for:n.id},Object(o["J"])(n.label),9,se)):Object(o["g"])("",!0),Object(o["i"])("textarea",{ref:"textarea",class:Object(o["s"])({error:n.error}),id:n.id,name:n.id,required:n.required,disabled:n.disabled,readonly:n.readonly,placeholder:n.placeholder,value:n.modelValue,minLength:n.minLength?n.minLength:"",maxlength:n.maxLength?n.maxLength:"",onInput:t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t.target.value),e.$emit("input")}),onFocus:t[1]||(t[1]=function(t){return e.$emit("focus")}),onBlur:t[2]||(t[2]=function(t){return e.$emit("blur")}),onClick:t[3]||(t[3]=function(t){return e.$emit("click")}),onKeypress:[t[4]||(t[4]=Object(o["R"])((function(t){return e.$emit("keypressEnter")}),["enter"])),t[5]||(t[5]=function(t){return e.$emit("keypress")})]},null,42,le),n.error?(Object(o["x"])(),Object(o["h"])("span",ue,Object(o["J"])(n.message),1)):Object(o["g"])("",!0)],2)}n("a9e3");var fe={name:"BaseTextarea",props:{id:{type:String},label:{type:String,default:""},error:{type:Boolean,default:!1},required:{type:Boolean},message:{type:String,default:""},placeholder:{type:String,default:""},modelValue:{type:[String,Number],required:!0},minLength:{type:Number},maxLength:{type:Number},disabled:{type:Boolean},readonly:{type:Boolean}},methods:{},emits:["update:modelValue","clear","input","focus","blur","click","keypressEnter","keypress"]},be=(n("f26d"),n("d959")),pe=n.n(be);const he=pe()(fe,[["render",de],["__scopeId","data-v-10dfe7a2"]]);var Oe=he,je=n("be12"),me=(n("b680"),n("c8de")),ye=n.n(me),ge=function(e){return Object(o["A"])("data-v-4cfd3838"),e=e(),Object(o["y"])(),e},ve={key:0,class:"offer-create-table"},_e=ge((function(){return Object(o["i"])("thead",null,[Object(o["i"])("tr",null,[Object(o["i"])("th",null,"Артикул"),Object(o["i"])("th",null,"Наименование"),Object(o["i"])("th",null,"Цена"),Object(o["i"])("th",null,"Кол-во"),Object(o["i"])("th",null,"Скидка"),Object(o["i"])("th",null,"Стоимость"),Object(o["i"])("th")])],-1)})),ke={key:0},Ce={class:"tooltip"},we={class:"tooltip"},xe={class:"no-wrap"},$e={class:"no-wrap"},Ve={class:"no-wrap"},Pe={class:"tooltip"},Te={class:"no-wrap"},Se=["onClick"],Ue=ge((function(){return Object(o["i"])("img",{src:ye.a,alt:"Remove"},null,-1)})),Ie=[Ue],Je={key:1,class:"offer-create-table-mobile table-mobile",ref:"table"},Ee=["onClick"],Me=ge((function(){return Object(o["i"])("img",{src:ye.a,alt:"Remove"},null,-1)})),qe=[Me],Be={class:"table-mobile-row"},Ae=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Артикул ",-1)})),De={class:"table-mobile__value"},Fe={class:"table-mobile-row"},Qe=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Наим-ие ",-1)})),ze={class:"table-mobile__value"},Re={class:"table-mobile-row"},Le=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Цена ",-1)})),Ne={class:"table-mobile__value"},Ke={class:"table-mobile-row"},Ge=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Кол-во ",-1)})),He={class:"table-mobile__value"},We={class:"table-mobile-row"},Ye=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Скидка ",-1)})),Xe={class:"table-mobile__value"},Ze={class:"table-mobile-row"},et=ge((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Стоимость ",-1)})),tt={class:"table-mobile__value"},nt={key:2,class:"offer-create-price"},ot={class:"offer-create-price__discount"},rt=ge((function(){return Object(o["i"])("span",null," Скидка ",-1)})),ct={class:"offer-create-price__total"},at=ge((function(){return Object(o["i"])("span",null," Общая стоимость ",-1)}));function it(e,t,n,r,c,a){var i=Object(o["F"])("base-input"),s=Object(o["G"])("tooltip");return Object(o["x"])(),Object(o["h"])(o["b"],null,[e.$isMobile?n.products.length&&e.$isMobile?(Object(o["x"])(),Object(o["h"])("div",Je,[(Object(o["x"])(!0),Object(o["h"])(o["b"],null,Object(o["D"])(n.products,(function(t,n){return Object(o["x"])(),Object(o["h"])("div",{class:"table-mobile-column",key:n},[Object(o["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeProduct",t.id)}},qe,8,Ee),Object(o["i"])("div",Be,[Ae,Object(o["i"])("span",De,Object(o["J"])(t.article),1)]),Object(o["i"])("div",Fe,[Qe,Object(o["i"])("span",ze,Object(o["J"])(t.name),1)]),Object(o["i"])("div",Re,[Le,Object(o["i"])("span",Ne,[Object(o["k"])(i,{type:"text",tableInput:!0,symbol:"₽",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.price,"onUpdate:modelValue":function(e){return t.price=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])])]),Object(o["i"])("div",Ke,[Ge,Object(o["i"])("span",He,[Object(o["k"])(i,{type:"number",tableInput:!0,symbol:"шт",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.count,"onUpdate:modelValue":function(e){return t.count=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])])]),Object(o["i"])("div",We,[Ye,Object(o["i"])("span",Xe,[Object(o["k"])(i,{type:"number",tableInput:!0,symbol:"%",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.discount,"onUpdate:modelValue":function(e){return t.discount=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])])]),Object(o["i"])("div",Ze,[et,Object(o["i"])("span",tt,Object(o["J"])(t.cost)+" ₽ ",1)])])})),128))],512)):Object(o["g"])("",!0):(Object(o["x"])(),Object(o["h"])("table",ve,[_e,n.products.length?(Object(o["x"])(),Object(o["h"])("tbody",ke,[(Object(o["x"])(!0),Object(o["h"])(o["b"],null,Object(o["D"])(n.products,(function(t,n){return Object(o["x"])(),Object(o["h"])("tr",{key:n},[Object(o["i"])("td",null,[Object(o["i"])("span",null,Object(o["J"])(t.article),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",Ce,[Object(o["j"])(Object(o["J"])(t.article),1)])),[[s]])]),Object(o["i"])("td",null,[Object(o["i"])("span",null,Object(o["J"])(t.name),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",we,[Object(o["j"])(Object(o["J"])(t.name),1)])),[[s]])]),Object(o["i"])("td",xe,[Object(o["k"])(i,{type:"text",tableInput:!0,symbol:"₽",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.price,"onUpdate:modelValue":function(e){return t.price=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])]),Object(o["i"])("td",$e,[Object(o["k"])(i,{type:"number",tableInput:!0,symbol:"шт",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.count,"onUpdate:modelValue":function(e){return t.count=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])]),Object(o["i"])("td",Ve,[Object(o["k"])(i,{type:"number",tableInput:!0,symbol:"%",onBlur:function(n){return e.$emit("editProduct",t.id)},modelValue:t.discount,"onUpdate:modelValue":function(e){return t.discount=e}},null,8,["onBlur","modelValue","onUpdate:modelValue"])]),Object(o["i"])("td",null,[Object(o["i"])("span",null,Object(o["J"])(t.cost)+" ₽ ",1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",Pe,[Object(o["j"])(Object(o["J"])(t.cost)+" ₽ ",1)])),[[s]])]),Object(o["i"])("td",Te,[Object(o["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeProduct",t.id)}},Ie,8,Se)])])})),128))])):Object(o["g"])("",!0)])),n.products.length?(Object(o["x"])(),Object(o["h"])("div",nt,[Object(o["i"])("div",null,[Object(o["i"])("div",ot,[rt,Object(o["i"])("span",null,Object(o["J"])(a.totalDiscountedPrice.toFixed(2))+" ₽ ",1)]),Object(o["i"])("div",ct,[at,Object(o["i"])("span",null,Object(o["J"])((a.totalPrice-a.totalDiscountedPrice).toFixed(2))+" ₽ ",1)])])])):Object(o["g"])("",!0)],64)}n("4160"),n("159b");var st={name:"OfferCreateTable",props:{products:{type:Array}},computed:{totalDiscountedPrice:function(){var e=0;return 1===this.products.length?e=this.products[0].cost*this.products[0].discount/100:this.products.forEach((function(t){return e+=+t.cost*+t.discount/100})),e},totalPrice:function(){var e=0;return 1===this.products.length?e=this.products[0].cost:this.products.forEach((function(t){return e+=+t.cost})),e}},emits:["removeProduct","editProduct"]};n("b717");const lt=pe()(st,[["render",it],["__scopeId","data-v-4cfd3838"]]);var ut=lt,dt={components:{BaseTextarea:Oe,BaseSelect:je["a"],OfferCreateTable:ut},computed:{offerDate:function(){var e=new Date(this.offer.created_at),t=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.toLocaleString("ru",{month:"long"}),o=e.getFullYear();return"".concat(t," ").concat(n," ").concat(o)},edit:function(){return!!this.$route.query.id}},data:function(){return{offer:null,data:{counterparty:"",inn:"",address:"",phone:"",email:"",contactPerson:"",validy:"",endCustomer:"",region:"",tech_docs_format:"",tz:!1,ru:!1,tzType:"ktru",ready:""},openModal:!1,modalText:"Отправлено",products:[],productsSearch:"",companies:[{key:"Не Выбран",value:""}],company:"",counterparties:[],productSuggestions:[],currentCounterparty:{},customers:[],currentCustomer:{},productToSend:{}}},setup:function(){Object(ie["b"])({title:"Страница Коммерческого предложения"})},mounted:function(){this.edit&&this.getOffer(),this.getCompanies()},methods:{getCompanies:function(){var e=this;this.$api.get("".concat(this.$api.defaults.API,"/company")).then((function(t){var n,o=Object(ae["a"])(t.data.results);try{var r=function(){var t=n.value,o={key:t.name,value:t.id};!e.companies.some((function(e){return e.value==o.value}))&&o.key&&e.companies.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(c){o.e(c)}finally{o.f()}}))},getOffer:function(){var e=this;this.$store.dispatch("loading",!0),this.$api.get("".concat(this.$api.defaults.API,"/offer/").concat(this.$route.query.id)).then((function(t){e.offer=t.data,e.currentCounterparty=e.offer.counterparty||"",e.setCounterparty(),e.data.endCustomer=e.offer.end_customer&&e.offer.end_customer.name||"",e.data.region=e.offer.end_customer&&e.offer.end_customer.region||"",e.validy=e.offer.exploration_date||"",e.currentCustomer=e.offer.end_customer,e.products=e.offer.offer_products||"",e.data.company=t.data.company.id||"",e.data.tech_docs_format=e.offer.tech_docs_format,e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)}))},getProducts:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=Object(ce["a"])({},this.productsSearch&&"search",this.productsSearch);"search"===t?this.$api.get("".concat(this.$api.defaults.API,"/product"),{params:o}).then((function(n){e.productSuggestions=[];var o,r=Object(ae["a"])(n.data.results);try{for(r.s();!(o=r.n()).done;){var c=o.value;"search"!==t&&e.getProduct(),"search"==t&&e.productsSearch&&e.productSuggestions.push({key:c.name,value:c.id})}}catch(a){r.e(a)}finally{r.f()}})):this.$api.get("".concat(this.$api.defaults.API,"/product/").concat(n||this.productsSearch)).then((function(t){var n,o=(n={product:t.data.id},Object(ce["a"])(n,!e.edit&&"article",t.data.article),Object(ce["a"])(n,!e.edit&&"name",t.data.name),Object(ce["a"])(n,"price","".concat(t.data.price)),Object(ce["a"])(n,"discount",e.currentCounterparty.discount),Object(ce["a"])(n,"count",1),Object(ce["a"])(n,"cost","".concat(t.data.price)),n);e.productToSend=o}))},editProduct:function(e){var t=this,n=this.products.findIndex((function(t){return t.id===e})),o={product:this.products[n].product,price:this.products[n].price,discount:this.products[n].discount,count:this.products[n].count,cost:this.products[n].cost};this.edit&&this.$api.patch("".concat(this.$api.defaults.API,"/offer/").concat(this.offer.id,"/product/").concat(e),o).then((function(e){t.products[n]=e.data}))["catch"]((function(e){new Error(e)}))},addProduct:function(){var e=this;this.$store.dispatch("loading",!0),this.edit?this.$api.post("".concat(this.$api.defaults.API,"/offer/").concat(this.offer.id,"/product"),this.productToSend).then((function(t){e.products.push(t.data),e.productToSend={},e.productsSearch="",e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)})):(this.products.push(this.productToSend),this.productToSend={},this.productsSearch="",this.$store.dispatch("loading",!1))},removeProduct:function(e){var t=this;if(this.edit)this.$api["delete"]("".concat(this.$api.defaults.API,"/offer/").concat(this.offer.id,"/product/").concat(e)).then((function(){var n=t.products.findIndex((function(t){return t.id==e}));t.products.splice(n,1)}));else{var n=this.products.findIndex((function(t){return t.id==e}));this.products.splice(n,1)}},getCounterparty:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=Object(ce["a"])({},this.data.counterparty&&"search",this.data.counterparty);"search"==t?(this.counterparties=[],this.$api.get("".concat(this.$api.defaults.API,"/counterparty"),{params:o}).then((function(t){var n,o=Object(ae["a"])(t.data.results);try{var r=function(){var t=n.value,o={key:t.name||"",value:t.id||""};!e.counterparties.some((function(e){return e.value===o.value}))&&o.key&&e.counterparties.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(c){o.e(c)}finally{o.f()}}))):this.$api.get("".concat(this.$api.defaults.API,"/counterparty/").concat(n)).then((function(t){e.currentCounterparty=t.data,e.setCounterparty()}))},setCounterparty:function(){this.data.counterparty=this.currentCounterparty.name||"",this.data.inn=this.currentCounterparty.inn||"",this.data.address="".concat(this.currentCounterparty.address_street&&this.currentCounterparty.address_street+","," ").concat(this.currentCounterparty.address_city&&this.currentCounterparty.address_city+","," ").concat(this.currentCounterparty.address_country&&this.currentCounterparty.address_country+","," ").concat(this.currentCounterparty.address_index&&this.currentCounterparty.address_index),this.data.phone="+".concat(this.currentCounterparty.phone_number),this.data.email=this.currentCounterparty.email,this.data.contactPerson=this.currentCounterparty.contact_person||""},getEndCustomer:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=Object(ce["a"])({},this.data.endCustomer&&"search",this.data.endCustomer);"search"==t?(this.customers=[],this.$api.get("".concat(this.$api.defaults.API,"/end-customer"),{params:o}).then((function(t){var n,o=Object(ae["a"])(t.data.results);try{var r=function(){var t=n.value,o={key:t.name||"",value:t.id||""};!e.customers.some((function(e){return e.value===o.value}))&&o.key&&e.customers.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(c){o.e(c)}finally{o.f()}}))):this.$api.get("".concat(this.$api.defaults.API,"/end-customer/").concat(n)).then((function(t){e.currentCustomer=t.data,e.data.endCustomer=e.currentCustomer.name||"",e.data.region=e.currentCustomer.region||""}))},sendToEmail:function(e){var t=this;if("saved"===e){this.$store.dispatch("loading",!0);var n={send_to:this.data.email,co_format:this.data.tzType,required_tech_docs:this.data.tz,tech_docs_format:this.data.tech_docs_format,required_ru:this.data.ru};this.$api.post("".concat(this.$api.defaults.API,"/offer/").concat(this.offer.id,"/send-to-email"),n).then((function(){t.$store.dispatch("loading",!1),t.modalText="Отправлено",t.openModal=!0}))["catch"]((function(e){new Error(e),t.$store.dispatch("loading",!1)}))}else this.saveOffer("send")},saveOffer:function(e){var t=this;this.$store.dispatch("loading",!0);var n=[];if(!this.edit&&this.products){var o,r=Object(ae["a"])(this.products);try{for(r.s();!(o=r.n()).done;){var c=o.value;n.push({product:c.product,price:c.price,discount:c.discount,count:c.count,cost:c.cost})}}catch(i){r.e(i)}finally{r.f()}}var a={counterparty:this.currentCounterparty&&this.currentCounterparty.id||null,end_customer:this.currentCustomer&&this.currentCustomer.id||null,company:this.data.company||null,offer_products:n||[],tech_docs_format:this.data.tech_docs_format};this.edit?this.$api.patch("".concat(this.$api.defaults.API,"/offer/").concat(this.offer.id),a).then((function(){t.$store.dispatch("loading",!1),t.modalText="Сохранено",t.openModal=!0}))["catch"]((function(e){new Error(e),t.$store.dispatch("loading",!1)})):this.$api.post("".concat(this.$api.defaults.API,"/offer"),a).then((function(n){t.$store.dispatch("loading",!1),t.modalText="Сохранено",e||(t.openModal=!0),t.$store.dispatch("loading",!1),t.$router.push({query:{id:n.data.id}}),t.offer=n.data,"download"===e?t.download("saved"):t.sendToEmail("saved")}))["catch"]((function(e){new Error(e),t.$store.dispatch("loading",!1)}))},download:function(e){"saved"===e?window.open("excel"===this.data.tech_docs_format?this.offer.kp_excel_file:this.offer.kp_pdf_file,"_blank"):this.saveOffer("download")},closeModal:function(){this.openModal=!1,this.edit&&this.getOffer()}},beforeUnmount:function(){this.offer=null,this.products=[]}};n("4622");const ft=pe()(dt,[["render",re],["__scopeId","data-v-827cebf4"]]);t["default"]=ft},"7db0":function(e,t,n){"use strict";var o=n("23e7"),r=n("b727").find,c=n("44d2"),a="find",i=!0;a in[]&&Array(1)[a]((function(){i=!1})),o({target:"Array",proto:!0,forced:i},{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),c(a)},"8dbe":function(e,t,n){e.exports=n.p+"img/tz.3a9a68e5.svg"},a567:function(e,t,n){},b680:function(e,t,n){"use strict";var o=n("23e7"),r=n("da84"),c=n("e330"),a=n("5926"),i=n("408a"),s=n("1148"),l=n("d039"),u=r.RangeError,d=r.String,f=Math.floor,b=c(s),p=c("".slice),h=c(1..toFixed),O=function(e,t,n){return 0===t?n:t%2===1?O(e,t-1,n*e):O(e*e,t/2,n)},j=function(e){var t=0,n=e;while(n>=4096)t+=12,n/=4096;while(n>=2)t+=1,n/=2;return t},m=function(e,t,n){var o=-1,r=n;while(++o<6)r+=t*e[o],e[o]=r%1e7,r=f(r/1e7)},y=function(e,t){var n=6,o=0;while(--n>=0)o+=e[n],e[n]=f(o/t),o=o%t*1e7},g=function(e){var t=6,n="";while(--t>=0)if(""!==n||0===t||0!==e[t]){var o=d(e[t]);n=""===n?o:n+b("0",7-o.length)+o}return n},v=l((function(){return"0.000"!==h(8e-5,3)||"1"!==h(.9,0)||"1.25"!==h(1.255,2)||"1000000000000000128"!==h(0xde0b6b3a7640080,0)}))||!l((function(){h({})}));o({target:"Number",proto:!0,forced:v},{toFixed:function(e){var t,n,o,r,c=i(this),s=a(e),l=[0,0,0,0,0,0],f="",h="0";if(s<0||s>20)throw u("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return d(c);if(c<0&&(f="-",c=-c),c>1e-21)if(t=j(c*O(2,69,1))-69,n=t<0?c*O(2,-t,1):c/O(2,t,1),n*=4503599627370496,t=52-t,t>0){m(l,0,n),o=s;while(o>=7)m(l,1e7,0),o-=7;m(l,O(10,o,1),0),o=t-1;while(o>=23)y(l,1<<23),o-=23;y(l,1<<o),m(l,1,1),y(l,2),h=g(l)}else m(l,0,n),m(l,1<<-t,0),h=g(l)+b("0",s);return s>0?(r=h.length,h=f+(r<=s?"0."+b("0",s-r)+h:p(h,0,r-s)+"."+p(h,r-s))):h=f+h,h}})},b717:function(e,t,n){"use strict";n("1cd9")},be12:function(e,t,n){"use strict";n("99af");var o=n("7a23"),r={key:0},c={key:1,class:"selected ellipse"},a=["onClick"];function i(e,t,n,i,s,l){var u=Object(o["G"])("click-outside");return Object(o["Q"])((Object(o["x"])(),Object(o["h"])("div",{class:Object(o["s"])(["base-select",{"base-select-border":n.borderOnly}]),ref:"select"},[Object(o["i"])("div",{class:Object(o["s"])(["base-select-selected",[{open:s.open,disabled:n.disabled},{"base-select-selected-border":n.borderOnly,active:n.modelValue&&""!==n.modelValue}]]),onClick:t[0]||(t[0]=function(){return l.openDropdown&&l.openDropdown.apply(l,arguments)})},[!n.modelValue||""==n.modelValue&&n.placeholder?(Object(o["x"])(),Object(o["h"])("span",r,Object(o["J"])(n.placeholder),1)):(Object(o["x"])(),Object(o["h"])("span",c,Object(o["J"])(l.selected&&l.selected.key),1))],2),!n.disabled&&s.open?(Object(o["x"])(),Object(o["h"])("div",{key:0,class:Object(o["s"])(["base-select-items",{"base-select-items-border":n.borderOnly}]),ref:"dropdown",style:Object(o["t"])(s.dropdownDirection)},[(Object(o["x"])(!0),Object(o["h"])(o["b"],null,Object(o["D"])(n.options,(function(t,r){return Object(o["x"])(),Object(o["h"])("div",{key:"".concat(t.value,"_").concat(r),class:Object(o["s"])({active:n.modelValue==t.value}),onClick:function(n){l.selected=t,s.open=!1,e.$emit("update:modelValue",t.value),e.$emit("change")}},Object(o["J"])(t.key),11,a)})),128))],6)):Object(o["g"])("",!0)],2)),[[u,l.closeDropdown]])}n("a9e3"),n("7db0"),n("d3b7"),n("4795");var s={props:{options:{type:Array,required:!0},label:{type:String,default:""},placeholder:{type:[Number,String],default:""},disabled:{type:Boolean},borderOnly:{type:Boolean},modelValue:{type:[String,Number]},yellowBg:{type:Boolean}},computed:{selected:function(){var e=this;return this.options.find((function(t){return t.value===e.modelValue}))||""}},data:function(){return{open:!1,dropdownDirection:null}},methods:{openDropdown:function(){var e=this;this.disabled||(this.open=!this.open),this.open&&setTimeout((function(){var t=e.$refs.select.getBoundingClientRect().top,n=e.$refs.dropdown.getBoundingClientRect().height;window.innerHeight-t<n+60?e.dropdownDirection="top: auto; bottom: ".concat(e.borderOnly?23:40,"px"):e.dropdownDirection="top: ".concat(e.borderOnly?23:40,"px")}))},closeDropdown:function(){this.open=!1}},emits:["update:modelValue","change"]},l=(n("1e0b"),n("d959")),u=n.n(l);const d=u()(s,[["render",i],["__scopeId","data-v-ce2f6a6e"]]);t["a"]=d},da3f:function(e,t,n){"use strict";n.r(t);n("45fc"),n("d3b7"),n("07ac"),n("4de4");var o=n("7a23"),r=n("1d60"),c=n.n(r),a=n("c8de"),i=n.n(a),s=function(e){return Object(o["A"])("data-v-540df294"),e=e(),Object(o["y"])(),e},l={class:"offer"},u=s((function(){return Object(o["i"])("h1",{class:"offer__title page__title"},"Коммерческое предложение",-1)})),d={class:"offer-header__buttons"},f={class:"offer_create"},b=Object(o["j"])(" Создать "),p=s((function(){return Object(o["i"])("span",{class:"upp",style:{"margin-left":"2px"}}," кп",-1)})),h={class:"offer_copy"},O=Object(o["j"])(" Копировать "),j={class:"offer-search"},m={key:0,class:"offer-filters__button"},y={key:0,class:"offer-filters__count"},g=s((function(){return Object(o["i"])("img",{src:c.a,alt:"Filters"},null,-1)})),v={key:0,class:"offer-filters__close"},_={key:1,class:"offer-filters__title page__title"},k={class:"offer-filters_counterparty"},C={class:"offer-filters_region"},w={class:"offer-filters_customer"},x={key:2,class:"offer-filters_manager"},$={key:3,class:"offer-filters__apply page-buttons"},V={class:"offer-filters__apply-button"},P=Object(o["j"])(" Применить "),T={class:"offer-content page-wrapper"};function S(e,t,n,r,c,a){var s=Object(o["F"])("base-button"),S=Object(o["F"])("base-input"),U=Object(o["F"])("base-select"),I=Object(o["F"])("offers-table");return Object(o["x"])(),Object(o["h"])("section",l,[u,Object(o["i"])("div",{class:Object(o["s"])(["offer-header page-wrapper",{shadow:c.scrollStart}])},[Object(o["i"])("div",d,[Object(o["i"])("div",f,[Object(o["k"])(s,{type:"filled",onClicked:t[0]||(t[0]=function(t){return e.$router.push({name:"offerCreate"})})},{default:Object(o["P"])((function(){return[b,p]})),_:1})]),Object(o["i"])("div",h,[Object(o["k"])(s,{type:"outlined",onClicked:a.copy,disabled:!c.offerToCopy.length},{default:Object(o["P"])((function(){return[O]})),_:1},8,["onClicked","disabled"])])]),Object(o["i"])("div",j,[Object(o["k"])(S,{id:"offerSearch",placeholder:e.$isMobile?"Поиск":"Поиск по номеру КП, конечному заказчику, региону, контрагенту",search:!0,searchIcon:!0,suggestionWidth:380,suggestions:c.suggestions,onSetSuggestion:a.getOffers,onKeypressEnter:a.getOffers,onClear:t[1]||(t[1]=function(e){return c.query="",c.suggestions=[],a.getOffers()}),onInput:t[2]||(t[2]=function(e){return a.getOffers("search")}),modelValue:c.query,"onUpdate:modelValue":t[3]||(t[3]=function(e){return c.query=e})},null,8,["placeholder","suggestions","onSetSuggestion","onKeypressEnter","modelValue"])]),e.$isMobile?(Object(o["x"])(),Object(o["h"])("div",m,[Object.values(c.filters).some((function(e){return e}))?(Object(o["x"])(),Object(o["h"])("div",y,Object(o["J"])(Object.values(c.filters).filter((function(e){return""!==e})).length),1)):Object(o["g"])("",!0),Object(o["k"])(s,{type:"outlined",onClick:t[4]||(t[4]=function(t){return e.open=!0})},{default:Object(o["P"])((function(){return[g]})),_:1})])):Object(o["g"])("",!0)],2),!e.$isMobile||e.$isMobile&&e.open?(Object(o["x"])(),Object(o["h"])("div",{key:0,class:Object(o["s"])(["offer-filters page-wrapper",{open:e.showContent}])},[e.$isMobile?(Object(o["x"])(),Object(o["h"])("div",v,[Object(o["i"])("img",{src:i.a,alt:"Close",onClick:t[5]||(t[5]=function(){return e.closeDropdown&&e.closeDropdown.apply(e,arguments)})})])):Object(o["g"])("",!0),e.$isMobile?(Object(o["x"])(),Object(o["h"])("h4",_,"Фильтры")):Object(o["g"])("",!0),Object(o["i"])("div",k,[Object(o["k"])(S,{id:"offerSearchCounterparty",placeholder:"Контрагент",search:!0,suggestions:c.counterparties,onInput:t[6]||(t[6]=function(e){return a.getOffers("search")}),onKeypressEnter:a.getOffers,onSetSuggestion:t[7]||(t[7]=function(e){return c.filters.counterparty=e,a.getOffers()}),onClear:t[8]||(t[8]=function(e){return c.counterparty="",c.filters.counterparty="",c.counterparties=[],a.getOffers()}),modelValue:c.counterparty,"onUpdate:modelValue":t[9]||(t[9]=function(e){return c.counterparty=e})},null,8,["suggestions","onKeypressEnter","modelValue"])]),Object(o["i"])("div",C,[Object(o["k"])(U,{options:c.regions,placeholder:"Регион",modelValue:c.filters.region,"onUpdate:modelValue":t[10]||(t[10]=function(e){return c.filters.region=e}),onChange:a.getOffers},null,8,["options","modelValue","onChange"])]),Object(o["i"])("div",w,[Object(o["k"])(U,{options:c.customers,placeholder:"Конечный заказчик",modelValue:c.filters.customer,"onUpdate:modelValue":t[11]||(t[11]=function(e){return c.filters.customer=e}),onChange:a.getOffers},null,8,["options","modelValue","onChange"])]),a.user&&"manager"!==a.user.access_group?(Object(o["x"])(),Object(o["h"])("div",x,[Object(o["k"])(U,{options:c.managers,placeholder:"Менеджер",modelValue:c.filters.manager,"onUpdate:modelValue":t[12]||(t[12]=function(e){return c.filters.manager=e}),onChange:a.getOffers},null,8,["options","modelValue","onChange"])])):Object(o["g"])("",!0),e.$isMobile?(Object(o["x"])(),Object(o["h"])("div",$,[Object(o["i"])("div",V,[Object(o["k"])(s,{type:"filled",onClick:e.closeDropdown},{default:Object(o["P"])((function(){return[P]})),_:1},8,["onClick"])])])):Object(o["g"])("",!0)],2)):Object(o["g"])("",!0),Object(o["i"])("div",T,[Object(o["k"])(I,{offers:c.offers,onCopy:t[13]||(t[13]=function(e){c.offerToCopy=e}),onScroll:t[14]||(t[14]=function(e){c.scrollStart=e>0}),onScrolled:a.getNextPage},null,8,["offers","onScrolled"])])])}var U=n("ade3"),I=n("b85c"),J=(n("7db0"),n("b0c0"),n("d9e2"),n("d401"),n("be12")),E=n("304d"),M=(n("caad"),n("2532"),n("1aea")),q=n.n(M),B=n("0e34"),A=n.n(B),D=n("209a"),F=n.n(D),Q=n("8dbe"),z=n.n(Q),R=function(e){return Object(o["A"])("data-v-47e758b4"),e=e(),Object(o["y"])(),e},L={key:0,class:"offer-table"},N=R((function(){return Object(o["i"])("thead",null,[Object(o["i"])("tr",null,[Object(o["i"])("th"),Object(o["i"])("th",null,"Номер"),Object(o["i"])("th",null,"Дата создания"),Object(o["i"])("th",null,"Стоимость"),Object(o["i"])("th",null,"Контрагент"),Object(o["i"])("th",null,"Скидка"),Object(o["i"])("th",null,"Регион"),Object(o["i"])("th",null,"Файлы")])],-1)})),K={key:0,ref:"table"},G={class:"no-wrap"},H={class:"base-check"},W=["id","name","value","disabled"],Y=["for"],X=["onClick"],Z={class:"tooltip"},ee=["onClick"],te={class:"tooltip"},ne=["onClick"],oe={class:"tooltip"},re=["onClick"],ce={class:"tooltip"},ae=["onClick"],ie=["onClick"],se={class:"tooltip"},le={class:"no-wrap"},ue={class:"offer-actions"},de=["href"],fe=R((function(){return Object(o["i"])("img",{src:q.a,alt:"PDF",width:"29",height:"27"},null,-1)})),be=[fe],pe=["href"],he=R((function(){return Object(o["i"])("img",{src:A.a,alt:"Excel",width:"29",height:"27"},null,-1)})),Oe=[he],je=["href"],me=R((function(){return Object(o["i"])("img",{src:F.a,alt:"Ru",width:"22",height:"27"},null,-1)})),ye=[me],ge={class:"offer-action _tz"},ve=R((function(){return Object(o["i"])("img",{src:z.a,alt:"Tz",width:"22",height:"27"},null,-1)})),_e={class:"offer-action-dropdown"},ke={class:"offer-action-dropdown-content"},Ce={class:"base-check radio"},we=["id"],xe=["for"],$e={class:"base-check radio"},Ve=["id"],Pe=["for"],Te={class:"base-check radio"},Se=["id"],Ue=["for"],Ie=R((function(){return Object(o["i"])("span",{class:"upp"},"ктру",-1)})),Je=Object(o["j"])(" сокр. "),Ee=[Ie,Je],Me=Object(o["j"])(" Скачать "),qe={key:1,class:"offer-table-mobile table-mobile",ref:"table"},Be={class:"offer-table-mobile-checkbox"},Ae={class:"base-check"},De=["id","name","value","disabled"],Fe=["for"],Qe=["onClick"],ze=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Номер ",-1)})),Re={class:"table-mobile__value"},Le=["onClick"],Ne=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Дата созд. ",-1)})),Ke={class:"table-mobile__value"},Ge=["onClick"],He=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Стоимость ",-1)})),We={class:"table-mobile__value"},Ye=["onClick"],Xe=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Контрагент ",-1)})),Ze={class:"table-mobile__value"},et=["onClick"],tt=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Скидка ",-1)})),nt={class:"table-mobile__value"},ot=["onClick"],rt=R((function(){return Object(o["i"])("span",{class:"table-mobile__title"}," Регион ",-1)})),ct={class:"table-mobile__value"},at={class:"offer-actions"},it=["href"],st=R((function(){return Object(o["i"])("img",{src:q.a,alt:"PDF",width:"29",height:"27"},null,-1)})),lt=[st],ut=["href"],dt=R((function(){return Object(o["i"])("img",{src:A.a,alt:"Excel",width:"29",height:"27"},null,-1)})),ft=[dt],bt=["href"],pt=R((function(){return Object(o["i"])("img",{src:F.a,alt:"Ru",width:"22",height:"27"},null,-1)})),ht=[pt],Ot={class:"offer-action _tz"},jt=R((function(){return Object(o["i"])("img",{src:z.a,alt:"Tz",width:"22",height:"27"},null,-1)})),mt={class:"offer-action-dropdown"},yt={class:"offer-action-dropdown-content"},gt={class:"base-check radio"},vt=["id"],_t=["for"],kt={class:"base-check radio"},Ct=["id"],wt=["for"],xt={class:"base-check radio"},$t=["id"],Vt=["for"],Pt=R((function(){return Object(o["i"])("span",{class:"upp"},"ктру",-1)})),Tt=Object(o["j"])(" сокр. "),St=[Pt,Tt],Ut=Object(o["j"])(" Скачать "),It={key:2,class:"offer-content-notFound content-notFound"};function Jt(e,t,n,r,c,a){var i=Object(o["F"])("base-button"),s=Object(o["G"])("tooltip");return Object(o["x"])(),Object(o["h"])(o["b"],null,[e.$isMobile?n.offers.length&&e.$isMobile?(Object(o["x"])(),Object(o["h"])("div",qe,[(Object(o["x"])(!0),Object(o["h"])(o["b"],null,Object(o["D"])(n.offers,(function(n,r){return Object(o["x"])(),Object(o["h"])("div",{class:"table-mobile-column",key:r},[Object(o["i"])("div",Be,[Object(o["i"])("div",Ae,[Object(o["Q"])(Object(o["i"])("input",{type:"checkbox",id:n.id,name:n.id,value:n.id,disabled:c.offerToCopy.length&&!c.offerToCopy.includes(n.id),"onUpdate:modelValue":t[4]||(t[4]=function(e){return c.offerToCopy=e})},null,8,De),[[o["L"],c.offerToCopy]]),Object(o["i"])("label",{for:n.id},null,8,Fe)])]),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[ze,Object(o["i"])("span",Re,Object(o["J"])(n.id),1)],8,Qe),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Ne,Object(o["i"])("span",Ke,Object(o["J"])(n.created_at),1)],8,Le),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[He,Object(o["i"])("span",We,Object(o["J"])(n.total_cost)+" ₽ ",1)],8,Ge),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Xe,Object(o["i"])("span",Ze,Object(o["J"])(n.counterparty.name),1)],8,Ye),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[tt,Object(o["i"])("span",nt,Object(o["J"])(n.counterparty.discount)+"% ",1)],8,et),Object(o["i"])("div",{class:"table-mobile-row",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[rt,Object(o["i"])("span",ct,Object(o["J"])(n.end_customer&&n.end_customer.region),1)],8,ot),Object(o["i"])("div",at,[Object(o["i"])("a",{href:n.kp_pdf_file,class:"offer-action _pdf"},lt,8,it),Object(o["i"])("a",{href:n.kp_exel_file,class:"offer-action _excel"},ft,8,ut),Object(o["i"])("a",{href:n.ru_file,class:"offer-action _ru"},ht,8,bt),Object(o["i"])("div",Ot,[jt,Object(o["i"])("div",mt,[Object(o["i"])("div",yt,[Object(o["i"])("div",gt,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"ktru".concat(n.id),value:"ktru","onUpdate:modelValue":t[5]||(t[5]=function(e){return c.downloadType=e})},null,8,vt),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"ktru".concat(n.id),class:"upp"}," ктру ",8,_t)]),Object(o["i"])("div",kt,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"tu".concat(n.id),value:"tu","onUpdate:modelValue":t[6]||(t[6]=function(e){return c.downloadType=e})},null,8,Ct),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"tu".concat(n.id),class:"upp"}," ту ",8,wt)]),Object(o["i"])("div",xt,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"ktrus".concat(n.id),value:"ktrus","onUpdate:modelValue":t[7]||(t[7]=function(e){return c.downloadType=e})},null,8,$t),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"ktrus".concat(n.id)},St,8,Vt)]),Object(o["k"])(i,{type:"filled",onClicked:function(e){return a.download(n.id)}},{default:Object(o["P"])((function(){return[Ut]})),_:2},1032,["onClicked"])])])])])])})),128))],512)):Object(o["g"])("",!0):(Object(o["x"])(),Object(o["h"])("table",L,[N,n.offers.length?(Object(o["x"])(),Object(o["h"])("tbody",K,[(Object(o["x"])(!0),Object(o["h"])(o["b"],null,Object(o["D"])(n.offers,(function(n){return Object(o["x"])(),Object(o["h"])("tr",{key:n.id},[Object(o["i"])("td",G,[Object(o["i"])("div",H,[Object(o["Q"])(Object(o["i"])("input",{type:"checkbox",id:n.id,name:n.id,value:n.id,disabled:c.offerToCopy.length&&!c.offerToCopy.includes(n.id),"onUpdate:modelValue":t[0]||(t[0]=function(e){return c.offerToCopy=e})},null,8,W),[[o["L"],c.offerToCopy]]),Object(o["i"])("label",{for:n.id},null,8,Y)])]),Object(o["i"])("td",{onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.id),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",Z,[Object(o["j"])(Object(o["J"])(n.id),1)])),[[s]])],8,X),Object(o["i"])("td",{onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.created_at),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",te,[Object(o["j"])(Object(o["J"])(n.created_at),1)])),[[s]])],8,ee),Object(o["i"])("td",{onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.total_cost)+" ₽ ",1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",oe,[Object(o["j"])(Object(o["J"])(n.total_cost)+" ₽ ",1)])),[[s]])],8,ne),Object(o["i"])("td",{onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.counterparty.name),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",ce,[Object(o["j"])(Object(o["J"])(n.counterparty.name),1)])),[[s]])],8,re),Object(o["i"])("td",{class:"no-wrap",onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.counterparty.discount)+"% ",1)],8,ae),Object(o["i"])("td",{onClick:function(t){return e.$router.push({name:"offerCreate",query:{id:n.id}})}},[Object(o["i"])("span",null,Object(o["J"])(n.end_customer&&n.end_customer.region),1),Object(o["Q"])((Object(o["x"])(),Object(o["h"])("span",se,[Object(o["j"])(Object(o["J"])(n.end_customer&&n.end_customer.region),1)])),[[s]])],8,ie),Object(o["i"])("td",le,[Object(o["i"])("div",ue,[Object(o["i"])("a",{href:n.kp_pdf_file,class:"offer-action _pdf"},be,8,de),Object(o["i"])("a",{href:n.kp_exel_file,class:"offer-action _excel"},Oe,8,pe),Object(o["i"])("a",{href:n.ru_file,class:"offer-action _ru"},ye,8,je),Object(o["i"])("div",ge,[ve,Object(o["i"])("div",_e,[Object(o["i"])("div",ke,[Object(o["i"])("div",Ce,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"ktru".concat(n.id),value:"ktru","onUpdate:modelValue":t[1]||(t[1]=function(e){return c.downloadType=e})},null,8,we),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"ktru".concat(n.id),class:"upp"}," ктру ",8,xe)]),Object(o["i"])("div",$e,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"tu".concat(n.id),value:"tu","onUpdate:modelValue":t[2]||(t[2]=function(e){return c.downloadType=e})},null,8,Ve),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"tu".concat(n.id),class:"upp"}," ту ",8,Pe)]),Object(o["i"])("div",Te,[Object(o["Q"])(Object(o["i"])("input",{type:"radio",id:"ktrus".concat(n.id),value:"ktrus","onUpdate:modelValue":t[3]||(t[3]=function(e){return c.downloadType=e})},null,8,Se),[[o["M"],c.downloadType]]),Object(o["i"])("label",{for:"ktrus".concat(n.id)},Ee,8,Ue)]),Object(o["k"])(i,{type:"filled",onClicked:function(e){return a.download(n.id)}},{default:Object(o["P"])((function(){return[Me]})),_:2},1032,["onClicked"])])])])])])])})),128))],512)):Object(o["g"])("",!0)])),n.offers.length?Object(o["g"])("",!0):(Object(o["x"])(),Object(o["h"])("span",It," Ничего не найдено "))],64)}n("4795"),n("b680");var Et=n("30a8"),Mt={name:"OfferTable",props:{offers:{type:Array}},components:{BaseButton:Et["a"]},data:function(){return{offerToCopy:[],downloadType:"ktru"}},mounted:function(){var e=this;setTimeout((function(){var t=e.$refs.table;t&&t.addEventListener("scroll",(function(){e.onScroll(t)}))}),1e3)},methods:{onScroll:function(e){var t=+e.getBoundingClientRect().height.toFixed(0),n=+e.scrollHeight.toFixed(0),o=+e.scrollTop.toFixed(0);this.$emit("scroll",o),o+t==n&&this.$emit("scrolled")},download:function(e){var t=this.offers.find((function(t){return t.id===e}));window.open("ktru"===this.downloadType?t.krtu_file:"tu"===this.downloadType?t.krtu_avg_file:"ktrus"===this.downloadType?t.krtu_gost_file:"","_blank")}},watch:{offerToCopy:function(){this.$emit("copy",this.offerToCopy)}},emits:["download","scroll","scrolled","copy"]},qt=(n("6120"),n("d959")),Bt=n.n(qt);const At=Bt()(Mt,[["render",Jt],["__scopeId","data-v-47e758b4"]]);var Dt=At,Ft={components:{BaseSelect:J["a"],OffersTable:Dt},computed:{user:function(){return this.$store.getters.user}},data:function(){return{query:"",counterparty:"",scrollStart:!1,filters:{counterparty:"",region:"",customer:"",manager:""},regions:[{key:"Не Выбран",value:""}],customers:[{key:"Не Выбран",value:""}],page:1,hasNext:!1,offerToCopy:[],offers:[],counterparties:[],suggestions:[],managers:[{key:"Не Выбран",value:""}]}},mounted:function(){this.getOffers(),this.getRegions(),this.user&&"manager"!==this.user.access_group&&"director"!==this.user.access_group&&this.getManagers()},methods:{copy:function(){var e=this,t=this.offers.find((function(t){return t.id==e.offerToCopy[0]})),n=[];if(t.offer_products.length){var o,r=Object(I["a"])(t.offer_products);try{for(r.s();!(o=r.n()).done;){var c=o.value;n.push({product:c.product,price:c.price,discount:c.discount,count:c.count,cost:c.cost})}}catch(i){r.e(i)}finally{r.f()}}var a={counterparty:t.counterparty&&t.counterparty.id||null,end_customer:t.end_customer&&t.end_customer.id||null,company:t.company&&t.company.id||null,offer_products:n||[],tech_docs_format:t.tech_docs_format};this.$api.post("".concat(this.$api.defaults.API,"/offer"),a).then((function(t){e.$router.push({name:"offerCreate",query:{id:t.data.id}})}))},getOffers:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"loading"!==n&&(this.page=1),"search"!==n&&this.$store.dispatch("loading",!0);var o=(e={page:this.page},Object(U["a"])(e,this.query&&"search",this.query),Object(U["a"])(e,this.counterparty&&"counterparty",this.filters.counterparty?this.filters.counterparty:this.counterparty),Object(U["a"])(e,this.filters.customer&&"end_customer",this.filters.customer),Object(U["a"])(e,this.filters.region&&"end_customer__region",this.filters.region),Object(U["a"])(e,this.filters.manager&&"owner",this.filters.manager),e);this.counterparties=[],this.suggestions=[],this.customers=[{key:"Не Выбран",value:""}],this.$api.get("".concat(this.$api.defaults.API,"/offer"),{params:o}).then((function(e){t.hasNext=e.data.next,t.$store.dispatch("loading",!1),"search"!==n&&"loading"!==n&&(t.offers=[]);var o,r=Object(I["a"])(e.data.results);try{var c=function(){var e=o.value;"search"!==n&&t.offers.push(e),"search"==n&&t.query&&t.suggestions.push({key:e.id,value:e.id});var r={key:e.end_customer?e.end_customer.name:"",value:e.end_customer?e.end_customer.id:""};if(!t.customers.find((function(e){return e.value===r.value}))&&r.key&&t.customers.push(r),"search"==n){var c={key:e.counterparty.name,value:e.counterparty.id};!t.counterparties.find((function(e){return e.value===c.value}))&&c.key&&t.counterparty&&t.counterparties.push(c)}};for(r.s();!(o=r.n()).done;)c()}catch(a){r.e(a)}finally{r.f()}}))["catch"]((function(e){new Error(e),t.$store.dispatch("loading",!1),n||(t.offers=[])}))},getRegions:function(){var e=this;this.$api.get("".concat(this.$api.defaults.API,"/regions")).then((function(t){var n,o=Object(I["a"])(t.data);try{var r=function(){var t=n.value,o={key:t.region,value:t.region};!e.regions.some((function(e){return e.key==o.key}))&&e.regions.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(c){o.e(c)}finally{o.f()}}))},getManagers:function(){var e=this;this.$api.get("".concat(this.$api.defaults.API,"/user/managers")).then((function(t){var n,o=Object(I["a"])(t.data);try{var r=function(){var t=n.value,o={key:t.fio,value:t.id};!e.managers.some((function(e){return e.value==o.value}))&&e.managers.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(c){o.e(c)}finally{o.f()}}))},getNextPage:function(){this.hasNext&&(this.page++,this.getOffers("loading"))}},mixins:[E["a"]]};n("24ac");const Qt=Bt()(Ft,[["render",S],["__scopeId","data-v-540df294"]]);t["default"]=Qt},ebae:function(e,t,n){},f26d:function(e,t,n){"use strict";n("64fd")}}]);
//# sourceMappingURL=offers.7b5238ec.js.map