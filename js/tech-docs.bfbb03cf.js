(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tech-docs"],{"3b89":function(e,t,c){"use strict";c.r(t);var i=c("7a23"),a={class:"tech-certificate"},s=Object(i["i"])("h1",{class:"tech-certificate__title page__title"},"Техническое задание",-1),l={class:"tech-certificate-wrapper page-wrapper"},n={class:"tech-certificate-header"},o={class:"tech-certificate-header__title"},r=Object(i["j"])(" Поиск"),d={key:0},u=Object(i["j"])(": "),b={class:"tech-certificate-header__buttons"},h={class:"tech-certificate-header__kp"},j=Object(i["j"])(" по "),p=Object(i["i"])("span",{class:"upp",style:{"margin-left":"2px"}},"кп",-1),f={class:"tech-certificate-header__vendor"},O=Object(i["j"])(" по артикулу "),v={class:"tech-certificate-content"},m={class:"tech-certificate-article-field article-row _kp"},g={class:"tech-certificate-article-field article-row-field"},_={class:"tech-certificate-article-add article-row-button"},k=Object(i["j"])(" Добавить "),y={class:"tech-certificate-kp"},w={class:"tech-certificate-kp-fields fields"},$={key:0,class:"tech-certificate-fields-row fields-row _number"},T={class:"tech-certificate-fields-row fields-row _email"},x={class:"tech-certificate-type"},S=Object(i["i"])("span",{class:"tech-certificate-type__title"},"Тип",-1),A={class:"tech-certificate-types"},C={class:"base-check radio"},P=Object(i["i"])("label",{for:"techDocsKtru",class:"upp"}," ктру ",-1),D={class:"base-check radio"},I=Object(i["i"])("label",{for:"techDocsTu",class:"upp"}," ту ",-1),V={class:"base-check radio"},M=Object(i["i"])("label",{for:"techDocsKtrus"},[Object(i["i"])("span",{class:"upp"},"ктру"),Object(i["j"])(" сокр. ")],-1),J={class:"tech-certificate-buttons page-buttons _save"},E={class:"tech-certificate-buttons__send _save__button"},U=Object(i["j"])(" Отправить"),F={class:"tech-certificate-buttons__download"},K=Object(i["j"])("Скачать");function Q(e,t,c,Q,R,q){var W=Object(i["F"])("base-button"),G=Object(i["F"])("base-input"),N=Object(i["F"])("tech-docs-table"),z=Object(i["F"])("base-modal");return Object(i["x"])(),Object(i["h"])(i["b"],null,[Object(i["i"])("section",a,[s,Object(i["i"])("div",l,[Object(i["i"])("div",n,[Object(i["i"])("span",o,[r,e.$isMobile?Object(i["g"])("",!0):(Object(i["x"])(),Object(i["h"])("span",d," документа")),u]),Object(i["i"])("div",b,[Object(i["i"])("div",h,[Object(i["k"])(W,{type:"link-button",active:1==R.active,onClicked:t[0]||(t[0]=function(e){return R.active=1})},{default:Object(i["P"])((function(){return[j,p]})),_:1},8,["active"])]),Object(i["i"])("div",f,[Object(i["k"])(W,{type:"link-button",active:2==R.active,onClicked:t[1]||(t[1]=function(e){return R.active=2})},{default:Object(i["P"])((function(){return[O]})),_:1},8,["active"])])])]),Object(i["i"])("div",v,[2==R.active?(Object(i["x"])(),Object(i["h"])("div",{key:0,class:Object(i["s"])(["tech-certificate-article",{filled:R.articles.length}])},[Object(i["i"])("div",m,[Object(i["i"])("div",g,[Object(i["k"])(G,{id:"offerCreateConterparty",placeholder:"Артикул или наименование",search:!0,suggestionWidth:380,addProduct:!0,suggestions:R.articlesSuggestions,onSetSuggestion:t[2]||(t[2]=function(e){return R.article=e}),onClear:t[3]||(t[3]=function(e){return R.articleToSearch="",R.article="",R.articlesSuggestions=[]}),onInput:q.getArticles,modelValue:R.articleToSearch,"onUpdate:modelValue":t[4]||(t[4]=function(e){return R.articleToSearch=e})},null,8,["suggestions","onInput","modelValue"])]),Object(i["i"])("div",_,[Object(i["k"])(W,{type:"outlined",onClicked:q.addArticle},{default:Object(i["P"])((function(){return[k]})),_:1},8,["onClicked"])])]),Object(i["k"])(N,{articles:R.articles,onRemoveArticle:q.removeArticle},null,8,["articles","onRemoveArticle"])],2)):Object(i["g"])("",!0),Object(i["i"])("div",y,[Object(i["i"])("div",w,[1==R.active?(Object(i["x"])(),Object(i["h"])("div",$,[Object(i["k"])(G,{label:"№ КП",id:"techDocsKp",search:!0,addProduct:!0,suggestions:R.kpSuggestions,suggestionWidth:380,onClear:t[5]||(t[5]=function(e){return R.number="",R.kpSuggestions=[],q.getOffers()}),onInput:q.getOffers,modelValue:R.number,"onUpdate:modelValue":t[6]||(t[6]=function(e){return R.number=e})},null,8,["suggestions","onInput","modelValue"])])):Object(i["g"])("",!0),Object(i["i"])("div",T,[Object(i["k"])(G,{label:"Электронная почта",type:"email",id:"techEmail",modelValue:R.email,"onUpdate:modelValue":t[7]||(t[7]=function(e){return R.email=e})},null,8,["modelValue"])]),Object(i["i"])("div",x,[S,Object(i["i"])("div",A,[Object(i["i"])("div",C,[Object(i["Q"])(Object(i["i"])("input",{type:"radio",id:"techDocsKtru",value:"ktru","onUpdate:modelValue":t[8]||(t[8]=function(e){return R.docsType=e})},null,512),[[i["M"],R.docsType]]),P]),Object(i["i"])("div",D,[Object(i["Q"])(Object(i["i"])("input",{type:"radio",id:"techDocsTu",value:"tu","onUpdate:modelValue":t[9]||(t[9]=function(e){return R.docsType=e})},null,512),[[i["M"],R.docsType]]),I]),Object(i["i"])("div",V,[Object(i["Q"])(Object(i["i"])("input",{type:"radio",id:"techDocsKtrus",value:"ktrus","onUpdate:modelValue":t[10]||(t[10]=function(e){return R.docsType=e})},null,512),[[i["M"],R.docsType]]),M])])])])])])]),Object(i["i"])("div",J,[Object(i["i"])("div",E,[Object(i["k"])(W,{type:"filled",onClicked:q.send},{default:Object(i["P"])((function(){return[U]})),_:1},8,["onClicked"])]),Object(i["i"])("div",F,[Object(i["k"])(W,{type:"outlined",onClicked:t[11]||(t[11]=function(e){return q.download()})},{default:Object(i["P"])((function(){return[K]})),_:1})])])]),Object(i["k"])(z,{open:R.openModal,text:"Отправлено",onClose:t[12]||(t[12]=function(e){return R.openModal=!1})},null,8,["open"])],64)}var R=c("b85c"),q=c("ade3"),W=(c("d9e2"),c("d401"),c("b0c0"),c("99af"),c("45fc"),c("d3b7"),c("c740"),c("a434"),c("213a")),G=c("c8de"),N=c.n(G),z={key:0,class:"tech-certificate-article-table"},B=Object(i["i"])("thead",null,[Object(i["i"])("tr",null,[Object(i["i"])("th",null,"Артикул"),Object(i["i"])("th",null,"Наименование"),Object(i["i"])("th")])],-1),H={key:0},L={class:"tooltip"},X={class:"tooltip"},Y={class:"no-wrap"},Z=["onClick"],ee=Object(i["i"])("img",{src:N.a,alt:"Remove"},null,-1),te=[ee],ce={key:1,class:"tech-certificate-table-mobile table-mobile",ref:"table"},ie=["onClick"],ae=Object(i["i"])("img",{src:N.a,alt:"Remove"},null,-1),se=[ae],le={class:"table-mobile-row"},ne=Object(i["i"])("span",{class:"table-mobile__title tech-certificate-table-mobile__title"}," Артикул ",-1),oe={class:"table-mobile__value"},re={class:"table-mobile-row"},de=Object(i["i"])("span",{class:"table-mobile__title tech-certificate-table-mobile__title"}," Наим-ие ",-1),ue={class:"table-mobile__value"};function be(e,t,c,a,s,l){var n=Object(i["G"])("tooltip");return e.$isMobile?c.articles.length&&e.$isMobile?(Object(i["x"])(),Object(i["h"])("div",ce,[(Object(i["x"])(!0),Object(i["h"])(i["b"],null,Object(i["D"])(c.articles,(function(t){return Object(i["x"])(),Object(i["h"])("div",{class:"table-mobile-column",key:t.id},[Object(i["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeArticle",t.id)}},se,8,ie),Object(i["i"])("div",le,[ne,Object(i["i"])("span",oe,Object(i["J"])(t.article),1)]),Object(i["i"])("div",re,[de,Object(i["i"])("span",ue,Object(i["J"])(t.name),1)])])})),128))],512)):Object(i["g"])("",!0):(Object(i["x"])(),Object(i["h"])("table",z,[B,c.articles.length?(Object(i["x"])(),Object(i["h"])("tbody",H,[(Object(i["x"])(!0),Object(i["h"])(i["b"],null,Object(i["D"])(c.articles,(function(t){return Object(i["x"])(),Object(i["h"])("tr",{key:t.id},[Object(i["i"])("td",null,[Object(i["i"])("span",null,Object(i["J"])(t.article),1),Object(i["Q"])((Object(i["x"])(),Object(i["h"])("span",L,[Object(i["j"])(Object(i["J"])(t.article),1)])),[[n]])]),Object(i["i"])("td",null,[Object(i["i"])("span",null,Object(i["J"])(t.name),1),Object(i["Q"])((Object(i["x"])(),Object(i["h"])("span",X,[Object(i["j"])(Object(i["J"])(t.name),1)])),[[n]])]),Object(i["i"])("td",Y,[Object(i["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeArticle",t.id)}},te,8,Z)])])})),128))])):Object(i["g"])("",!0)]))}var he={props:{articles:{type:Array}}},je=c("d959"),pe=c.n(je);const fe=pe()(he,[["render",be]]);var Oe=fe,ve={name:"TechDocs",components:{TechDocsTable:Oe},data:function(){return{active:1,number:"",techFieldsNumber:!1,email:"",docsType:"",techDocsArticle:"",article:"",articleToSearch:"",openModal:!1,articles:[],kpSuggestions:[],articlesSuggestions:[]}},setup:function(){Object(W["b"])({title:"Техническое задание"})},methods:{getOffers:function(){var e=this;this.kpSuggestions=[];var t=Object(q["a"])({},this.number&&"search",this.number);this.$api.get("".concat(this.$api.defaults.API,"/company"),{params:t}).then((function(t){var c,i=Object(R["a"])(t.data.results);try{for(i.s();!(c=i.n()).done;){var a=c.value;e.number&&e.kpSuggestions.push({key:a.id,value:a.id})}}catch(s){i.e(s)}finally{i.f()}}))["catch"]((function(e){return new Error(e)}))},getArticles:function(){var e=this;this.articlesSuggestions=[];var t=Object(q["a"])({},this.articleToSearch&&"search",this.articleToSearch);this.$api.get("".concat(this.$api.defaults.API,"/product"),{params:t}).then((function(t){var c,i=Object(R["a"])(t.data.results);try{for(i.s();!(c=i.n()).done;){var a=c.value;e.articleToSearch&&e.articlesSuggestions.push({key:a.name,value:a.id})}}catch(s){i.e(s)}finally{i.f()}}))["catch"]((function(e){return new Error(e)}))},addArticle:function(){var e=this;this.$store.dispatch("loading",!0),this.$api.get("".concat(this.$api.defaults.API,"/product/").concat(this.article)).then((function(t){!e.articles.some((function(e){return e.id==t.data.id}))&&e.articles.push(t.data),e.article="",e.articleToSearch="",e.articlesSuggestions=[],e.$store.dispatch("loading",!1)}))},send:function(){var e=this;if(1===this.active){var t={send_to:this.email,co_format:this.docsType,required_tech_docs:!0,tech_docs_format:"excel",required_ru:!1};this.number&&this.email&&this.docsType&&(this.$store.dispatch("loading",!0),this.$api.post("".concat(this.$api.defaults.API,"/offer/").concat(this.number,"/send-to-email"),t).then((function(){e.modalText="Отправлено",e.openModal=!0,e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)})))}else{var c,i=[],a=Object(R["a"])(this.articles);try{for(a.s();!(c=a.n()).done;){var s=c.value;i.push(s.id)}}catch(n){a.e(n)}finally{a.f()}var l={send_to:this.email,tech_docs_format:"excel",articles:i};this.articles.length&&this.email&&this.docsType&&(this.$store.dispatch("loading",!0),this.$api.post("".concat(this.$api.defaults.API,"/tech-docs/send-to-email"),l).then((function(){e.modalText="Отправлено",e.openModal=!0,e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)})))}},download:function(){var e=this;if(this.$store.dispatch("loading",!0),1===this.active)this.$api.get("".concat(this.$api.defaults.API,"/offer/").concat(this.number)).then((function(t){window.open(t.data.kp_exel_file,"_blank"),e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)}));else{var t,c=[],i=Object(R["a"])(this.articles);try{for(i.s();!(t=i.n()).done;){var a=t.value;c.push(a.id)}}catch(l){i.e(l)}finally{i.f()}var s={tech_docs_format:"excel",articles:c};this.$api.post("".concat(this.$api.defaults.API,"/tech-docs/download"),s).then((function(t){window.open(t.data.url,"_blank"),e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)}))}},removeArticle:function(e){var t=this.articles.findIndex((function(t){return t.id===e}));this.articles.splice(t,1)}}};const me=pe()(ve,[["render",Q]]);t["default"]=me}}]);
//# sourceMappingURL=tech-docs.bfbb03cf.js.map