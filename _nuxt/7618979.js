(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{739:function(t,e,n){"use strict";n.r(e);var o=n(2),l=(n(22),n(30),n(12),n(8),n(57),n(117)),r=n(36),c=n(7),m=n(62),d={name:"PostCommentForm",components:{CustomIcon:c.default,RcButton:m.default,ImgWithPlaceholder:l.default,AvatarImage:r.default},props:{contentId:{type:Number,required:!0}},data:function(){return{inputComment:"",files:[],loading:!1}},computed:{hasErrors:function(){return Boolean(this.inputComment)||Boolean(this.files.length)||this.loading}},methods:{focusToTextarea:function(){var t,e,n,o;null===(t=this.$refs)||void 0===t||null===(e=t.input)||void 0===e||null===(n=e.$el)||void 0===n||null===(o=n.focus)||void 0===o||o.call(n)},onInput:function(){this.inputComment||this.$emit("clear-input-comment")},removeFile:function(t){this.files=this.files.filter((function(e){return e.id!==t}))},submit:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,l,r,c,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,r=t.$objectToFormData({contentId:t.contentId,content:t.inputComment,files:null===(n=t.files)||void 0===n||null===(o=n.map)||void 0===o?void 0:o.call(n,(function(t){return null==t?void 0:t.file}))}),e.next=4,t.$api.feed.createComment(t.contentId,r);case 4:if(c=e.sent,t.loading=!1,null==c||null===(l=c.content)||void 0===l||!l[0]){e.next=9;break}return t.$notify({type:"error",title:null==c||null===(m=c.content)||void 0===m?void 0:m[0]}),e.abrupt("return");case 9:t.inputComment="",t.files=[],t.$emit("refresh-post-comments"),t.$emit("clear-input-comment");case 13:case"end":return e.stop()}}),e)})))()},clickAttach:function(){var t,e,n;null===(t=this.$refs)||void 0===t||null===(e=t.postUploadImgInput)||void 0===e||null===(n=e.click)||void 0===n||n.call(e)},setFiles:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$addFilesWithPreview(e.files,t,e.$postCommentFilesLimit());case 2:e.files=n.sent;case 3:case"end":return n.stop()}}),n)})))()}}},f=n(0),component=Object(f.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"post-comment-form__container"},[n("hr",{staticClass:"border-t-[0.5px] border-white-20 w-full xs:mt-3"}),t._v(" "),n("div",{staticClass:"post-comment-form flex items-start mt-3 h-full"},[n("input",{ref:"postUploadImgInput",staticClass:"hidden",attrs:{type:"file",multiple:"",accept:t.$acceptForPostCommentFiles()},on:{change:t.setFiles}}),t._v(" "),n("avatar-image",{staticClass:"xs:hidden",attrs:{"img-class":"h-[35px] w-[35px]",src:t.$userAvatar()}}),t._v(" "),n("div",{staticClass:"relative mx-2 w-full min-h-[40px] h-full cursor-text rounded-sm bg-white-80"},[t.files&&t.files.length>0?n("div",{ref:"fileThumbnails",staticClass:"create-post-media-content--thumbnails gap-2 pr-8 pt-1 pl-1",on:{click:function(e){return e.target!==e.currentTarget?null:t.focusToTextarea.apply(null,arguments)}}},[t._l(t.files,(function(e){return[n("div",{key:e.id,staticClass:"create-post-media-content--thumbnails--item create-post-media-content--thumbnails--item--small"},[n("button",{staticClass:"absolute px-[9px] h-4 w-4 z-2 top-[3px] right-[3px] rounded-full bg-black-100 bg-opacity-70 pseudo-icon",on:{click:function(n){return n.target!==n.currentTarget?null:t.removeFile(e.id)}}}),t._v(" "),n("img-with-placeholder",{staticClass:"w-full h-full object-cover rounded-[5px] hover:opacity-95",attrs:{src:e.path,alt:"Upload img",draggable:"false"}})],1)]}))],2):t._e(),t._v(" "),n("textarea-autosize",{ref:"input",staticClass:"post-comment-form__textarea pt-2",class:{"post-comment-form__textarea--with-files":t.files&&t.files.length>0},attrs:{type:"text",rows:"1","min-height":40,"max-height":258},on:{input:t.onInput},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.submit.apply(null,arguments):null}},model:{value:t.inputComment,callback:function(e){t.inputComment=e},expression:"inputComment"}}),t._v(" "),n("button",{staticClass:"absolute top-[8px] right-[8px]",on:{click:t.clickAttach}},[n("custom-icon",{attrs:{"icon-id":"#i-post-attachment"}})],1)],1),t._v(" "),n("rc-button",{staticClass:"post-comment-form--submit",attrs:{"disable-outlined":"",light:"",disabled:!t.hasErrors},on:{click:t.submit}},[n("span",{staticClass:"xs:hidden"},[t._v("Опубликовать")]),t._v(" "),n("span",{staticClass:"hidden xs:inline"},[t._v(">")])])],1)])}),[],!1,null,null,null);e.default=component.exports}}]);