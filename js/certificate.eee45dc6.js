(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["certificate"],{"11cb":function(e,t,c){"use strict";c.r(t);var i=c("7a23"),a={class:"tech-certificate"},l=Object(i["i"])("h1",{class:"tech-certificate__title page__title"}," Регистрационное удостоверение ",-1),n={class:"tech-certificate-wrapper page-wrapper"},s={class:"tech-certificate-header"},r={class:"tech-certificate-header__title"},o=Object(i["j"])(" Поиск"),d={key:0},b=Object(i["j"])(": "),u={class:"tech-certificate-header__buttons"},h={class:"tech-certificate-header__kp"},f=Object(i["j"])(" по "),j=Object(i["i"])("span",{class:"upp",style:{"margin-left":"2px"}},"кп",-1),O={class:"tech-certificate-header__vendor"},p=Object(i["j"])(" по артикулу "),v={class:"tech-certificate-content"},m={class:"tech-certificate-article-field article-row _kp"},g={class:"offer-create-products-field article-row-field"},_={class:"offer-create-products-add article-row-button"},k=Object(i["j"])(" Добавить "),w={class:"tech-certificate-kp"},y={class:"tech-certificate-kp-fields fields"},$={key:0,class:"tech-certificate-fields-row fields-row _number"},x={class:"tech-certificate-fields-row fields-row _email"},C={class:"tech-certificate-buttons page-buttons _save _ru"},A={class:"tech-certificate-buttons__send _save__button"},P=Object(i["j"])("Отправить"),I={class:"tech-certificate-buttons__download"},S=Object(i["j"])("Скачать");function V(e,t,c,V,J,M){var E=Object(i["F"])("base-button"),T=Object(i["F"])("base-input"),F=Object(i["F"])("certificates-table"),R=Object(i["F"])("base-modal");return Object(i["x"])(),Object(i["h"])(i["b"],null,[Object(i["i"])("section",a,[l,Object(i["i"])("div",n,[Object(i["i"])("div",s,[Object(i["i"])("span",r,[o,e.$isMobile?Object(i["g"])("",!0):(Object(i["x"])(),Object(i["h"])("span",d," документа")),b]),Object(i["i"])("div",u,[Object(i["i"])("div",h,[Object(i["k"])(E,{type:"link-button",active:1==J.active,onClicked:t[0]||(t[0]=function(e){return J.active=1})},{default:Object(i["P"])((function(){return[f,j]})),_:1},8,["active"])]),Object(i["i"])("div",O,[Object(i["k"])(E,{type:"link-button",active:2==J.active,onClicked:t[1]||(t[1]=function(e){return J.active=2})},{default:Object(i["P"])((function(){return[p]})),_:1},8,["active"])])])]),Object(i["i"])("div",v,[2==J.active?(Object(i["x"])(),Object(i["h"])("div",{key:0,class:Object(i["s"])(["tech-certificate-article",{filled:J.articles.length}])},[Object(i["i"])("div",m,[Object(i["i"])("div",g,[Object(i["k"])(T,{id:"offerCreateConterparty",placeholder:"Артикул или наименование",search:!0,suggestionWidth:380,addProduct:!0,suggestions:J.articlesSuggestions,onClear:t[2]||(t[2]=function(e){return J.article="",J.articlesSuggestions=[]}),onInput:M.getArticles,modelValue:J.article,"onUpdate:modelValue":t[3]||(t[3]=function(e){return J.article=e})},null,8,["suggestions","onInput","modelValue"])]),Object(i["i"])("div",_,[Object(i["k"])(E,{type:"outlined",onClicked:M.addArticle},{default:Object(i["P"])((function(){return[k]})),_:1},8,["onClicked"])])]),Object(i["k"])(F,{articles:J.articles,onRemoveArticle:M.removeArticle},null,8,["articles","onRemoveArticle"])],2)):Object(i["g"])("",!0),Object(i["i"])("div",w,[Object(i["i"])("div",y,[1==J.active?(Object(i["x"])(),Object(i["h"])("div",$,[Object(i["k"])(T,{label:"№ КП",id:"techDocsKp",search:!0,suggestionWidth:380,addProduct:!0,suggestions:J.kpSuggestions,onClear:t[4]||(t[4]=function(e){return J.number="",J.kpSuggestions=[]}),onInput:M.getOffers,modelValue:J.number,"onUpdate:modelValue":t[5]||(t[5]=function(e){return J.number=e})},null,8,["suggestions","onInput","modelValue"])])):Object(i["g"])("",!0),Object(i["i"])("div",x,[Object(i["k"])(T,{label:"Электронная почта",id:"techEmail",modelValue:J.email,"onUpdate:modelValue":t[6]||(t[6]=function(e){return J.email=e})},null,8,["modelValue"])])])])])]),Object(i["i"])("div",C,[Object(i["i"])("div",A,[Object(i["k"])(E,{type:"filled",onClicked:M.send},{default:Object(i["P"])((function(){return[P]})),_:1},8,["onClicked"])]),Object(i["i"])("div",I,[Object(i["k"])(E,{type:"outlined",onClicked:M.download},{default:Object(i["P"])((function(){return[S]})),_:1},8,["onClicked"])])])]),Object(i["k"])(R,{open:J.openModal,text:J.modalText,onClose:t[7]||(t[7]=function(e){return J.openModal=!1})},null,8,["open","text"])],64)}var J=c("b85c"),M=c("ade3"),E=(c("d9e2"),c("d401"),c("99af"),c("45fc"),c("d3b7"),c("c740"),c("a434"),c("213a")),T=(c("b0c0"),c("c8de")),F=c.n(T),R={key:0,class:"tech-certificate-article-table"},D=Object(i["i"])("thead",null,[Object(i["i"])("tr",null,[Object(i["i"])("th",null,"Артикул"),Object(i["i"])("th",null,"Наименование"),Object(i["i"])("th")])],-1),U={key:0},q={class:"tooltip"},Q={class:"tooltip"},W={class:"no-wrap"},G=["onClick"],K=Object(i["i"])("img",{src:F.a,alt:"Remove"},null,-1),z=[K],B={key:1,class:"tech-certificate-table-mobile table-mobile",ref:"table"},H=["onClick"],L=Object(i["i"])("img",{src:F.a,alt:"Remove"},null,-1),N=[L],X={class:"table-mobile-row"},Y=Object(i["i"])("span",{class:"table-mobile__title tech-certificate-table-mobile__title"}," Артикул ",-1),Z={class:"table-mobile__value"},ee={class:"table-mobile-row"},te=Object(i["i"])("span",{class:"table-mobile__title tech-certificate-table-mobile__title"}," Наим-ие ",-1),ce={class:"table-mobile__value"};function ie(e,t,c,a,l,n){var s=Object(i["G"])("tooltip");return e.$isMobile?c.articles.length&&e.$isMobile?(Object(i["x"])(),Object(i["h"])("div",B,[(Object(i["x"])(!0),Object(i["h"])(i["b"],null,Object(i["D"])(c.articles,(function(t){return Object(i["x"])(),Object(i["h"])("div",{class:"table-mobile-column",key:t.id},[Object(i["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeArticle",t.id)}},N,8,H),Object(i["i"])("div",X,[Y,Object(i["i"])("span",Z,Object(i["J"])(t.article),1)]),Object(i["i"])("div",ee,[te,Object(i["i"])("span",ce,Object(i["J"])(t.name),1)])])})),128))],512)):Object(i["g"])("",!0):(Object(i["x"])(),Object(i["h"])("table",R,[D,c.articles.length?(Object(i["x"])(),Object(i["h"])("tbody",U,[(Object(i["x"])(!0),Object(i["h"])(i["b"],null,Object(i["D"])(c.articles,(function(t){return Object(i["x"])(),Object(i["h"])("tr",{key:t.id},[Object(i["i"])("td",null,[Object(i["i"])("span",null,Object(i["J"])(t.article),1),Object(i["Q"])((Object(i["x"])(),Object(i["h"])("span",q,[Object(i["j"])(Object(i["J"])(t.article),1)])),[[s]])]),Object(i["i"])("td",null,[Object(i["i"])("span",null,Object(i["J"])(t.name),1),Object(i["Q"])((Object(i["x"])(),Object(i["h"])("span",Q,[Object(i["j"])(Object(i["J"])(t.name),1)])),[[s]])]),Object(i["i"])("td",W,[Object(i["i"])("span",{class:"_remove",onClick:function(){e.$emit("removeArticle",t.id)}},z,8,G)])])})),128))])):Object(i["g"])("",!0)]))}var ae={props:{articles:{type:Array}}},le=c("d959"),ne=c.n(le);const se=ne()(ae,[["render",ie]]);var re=se,oe={name:"Certificate",components:{CertificatesTable:re},data:function(){return{active:1,number:"",email:"",article:"",openModal:!1,modalText:"",articles:[],kpSuggestions:[],articlesSuggestions:[]}},setup:function(){Object(E["b"])({title:"Регистрационное удостоверение"})},methods:{getOffers:function(){var e=this;this.kpSuggestions=[];var t=Object(M["a"])({},this.number&&"search",this.number);this.$api.get("".concat(this.$api.defaults.API,"/company"),{params:t}).then((function(t){var c,i=Object(J["a"])(t.data.results);try{for(i.s();!(c=i.n()).done;){var a=c.value;e.number&&e.kpSuggestions.push({key:a.id,value:a.id})}}catch(l){i.e(l)}finally{i.f()}}))["catch"]((function(e){return new Error(e)}))},getArticles:function(){var e=this;this.articlesSuggestions=[];var t=Object(M["a"])({},this.article&&"search",this.article);this.$api.get("".concat(this.$api.defaults.API,"/product"),{params:t}).then((function(t){var c,i=Object(J["a"])(t.data.results);try{for(i.s();!(c=i.n()).done;){var a=c.value;e.article&&e.articlesSuggestions.push({key:a.id,value:a.id})}}catch(l){i.e(l)}finally{i.f()}}))["catch"]((function(e){return new Error(e)}))},addArticle:function(){var e=this;this.$store.dispatch("loading",!0),this.$api.get("".concat(this.$api.defaults.API,"/product/").concat(this.article)).then((function(t){!e.articles.some((function(e){return e.article==t.data.article}))&&e.articles.push(t.data),e.article="",e.$store.dispatch("loading",!1)}))},send:function(){var e=this;if(this.$store.dispatch("loading",!0),1===this.active){var t={send_to:this.email,co_format:"",required_tech_docs:!1,tech_docs_format:"pdf",required_ru:!0};this.$api.post("".concat(this.$api.defaults.API,"/offer/").concat(this.number,"/send-to-email"),t).then((function(){e.modalText="Отправлено",e.openModal=!0,e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)}))}else{var c,i=[],a=Object(J["a"])(this.articles);try{for(a.s();!(c=a.n()).done;){var l=c.value;i.push(l.id)}}catch(s){a.e(s)}finally{a.f()}var n={send_to:this.email,articles:i};this.$api.post("".concat(this.$api.defaults.API,"/permit-document/send-to-email"),n).then((function(){e.modalText="Отправлено",e.openModal=!0,e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!1)}))}},download:function(){var e=this;if(this.$store.dispatch("loading",!0),1===this.active)console.log(123),this.$store.dispatch("loading",!1);else{var t,c=[],i=Object(J["a"])(this.articles);try{for(i.s();!(t=i.n()).done;){var a=t.value;c.push(a.id)}}catch(n){i.e(n)}finally{i.f()}var l={tech_docs_format:"pdf",articles:c};this.$api.post("".concat(this.$api.defaults.API,"/tech-docs/download"),l).then((function(t){window.open(t.data.url,"_blank"),e.$store.dispatch("loading",!1)}))["catch"]((function(t){new Error(t),e.$store.dispatch("loading",!0)}))}},removeArticle:function(e){var t=this.articles.findIndex((function(t){return t.article===e}));this.articles.splice(t,1)}}};const de=ne()(oe,[["render",V]]);t["default"]=de}}]);
//# sourceMappingURL=certificate.eee45dc6.js.map